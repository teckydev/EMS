<div class="p-4">
  <div class="button-container">
    <button
      mat-raised-button
      [color]="isCheckedIn ? 'warn' : 'primary'"
      (click)="checkIn()"
      [disabled]="isCheckedIn"
    >
      {{ isCheckedIn ? "Checked In" : "Check In" }}
    </button>

    <button
      mat-raised-button
      color="accent"
      class="ml-4"
      (click)="checkOut()"
      [disabled]="!isCheckedIn"
    >
      {{ isCheckedIn ? "Check Out" : "---" }}
    </button>
  </div>

  <div class="p-6 bg-white rounded-lg shadow-md">
    <h2 class="text-lg font-semibold mb-4">My Attendance History</h2>

    <!-- <div *ngIf="loading" class="text-center text-gray-500 py-4">
      Loading attendance...
    </div> -->

    <table
        *ngIf="!loading && dataSource.data.length"
  mat-table
  [dataSource]="dataSource"
      class="mat-elevation-z8 w-full"
    >
      <!-- Date -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let record">
          {{ record.date | date : "MMM d, y" }}
        </td>
      </ng-container>

      <!-- Sessions -->
      <ng-container matColumnDef="sessions">
        <th mat-header-cell *matHeaderCellDef>Sessions</th>
        <td mat-cell *matCellDef="let record">
          <div *ngIf="record.sessions?.length; else noSession">
            <div *ngFor="let s of record.sessions; let i = index">
              {{ i + 1 }}.
              <span class="text-green-700">In:</span>
              {{ s.checkIn | date : "shortTime" }}
              <span *ngIf="s.checkOut" class="text-red-700">Out:</span>
              {{ s.checkOut ? (s.checkOut | date : "shortTime") : "—" }}
            </div>
          </div>
          <ng-template #noSession>—</ng-template>
        </td>
      </ng-container>

      <!-- Total Hours -->
      <ng-container matColumnDef="totalHours">
        <th mat-header-cell *matHeaderCellDef>Total Hours</th>
        <td mat-cell *matCellDef="let record">
          {{ formatHours(record.totalHours) }}
        </td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let record">
          <span
            [ngClass]="{
              'text-green-600 font-semibold': record.status === 'Present',
              'text-red-600 font-semibold': record.status === 'Absent',
              'text-yellow-600 font-semibold': record.status === 'Late'
            }"
          >
            {{ record.status }}
          </span>
        </td>
      </ng-container>

      <!-- Render rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <!-- Empty state -->
    <div
      *ngIf="!loading && attendanceData.length === 0"
      class="text-center text-gray-500 py-6"
    >
      No attendance records found.
    </div>
    <!-- ✅ Pagination -->
    <mat-paginator
      [pageSizeOptions]="[5, 10, 20]"
      [pageSize]="5"
      showFirstLastButtons
    >
    </mat-paginator>
  </div>
</div>
